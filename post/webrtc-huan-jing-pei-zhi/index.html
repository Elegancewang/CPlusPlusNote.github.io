<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WebRTC 环境配置 | Renzo&#39;s Blog</title>
<link rel="shortcut icon" href="https://elegancewang.github.io/CPlusPlusNote.github.io/favicon.ico?v=1600672859553">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://elegancewang.github.io/CPlusPlusNote.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="WebRTC 环境配置 | Renzo&#39;s Blog - Atom Feed" href="https://elegancewang.github.io/CPlusPlusNote.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="万事开头难啊，webRTC配置过程中遇到的问题多种多样，有些问题很难搜索到，因此我记录下来供自己参考。
写在前面的话
鉴于WebRTC更新太快，所以网上很多编译方法都失效了，所以如果你看到是几年前的文章，就没必要较真了。本文写作时间为202..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://elegancewang.github.io/CPlusPlusNote.github.io">
  <img class="avatar" src="https://elegancewang.github.io/CPlusPlusNote.github.io/images/avatar.png?v=1600672859553" alt="">
  </a>
  <h1 class="site-title">
    Renzo&#39;s Blog
  </h1>
  <p class="site-description">
    
  </p>
  <div class="menu-container">
    
      
        <a href="https://elegancewang.github.io/CPlusPlusNote.github.io" class="menu">
          首页
        </a>
      
    
      
        <a href="https://elegancewang.github.io/CPlusPlusNote.github.io/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="https://elegancewang.github.io/CPlusPlusNote.github.io/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              WebRTC 环境配置
            </h2>
            <div class="post-info">
              <span>
                09-16-2020
              </span>
              <span>
                4 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>万事开头难啊，webRTC配置过程中遇到的问题多种多样，有些问题很难搜索到，因此我记录下来供自己参考。</p>
<h1 id="写在前面的话">写在前面的话</h1>
<p>鉴于WebRTC更新太快，所以网上很多编译方法都失效了，所以如果你看到是几年前的文章，就没必要较真了。本文写作时间为2020年9月16日，WebRTC为当前最新版本。请诸君参考。（另，本人所在地为HK，因此不需要稳定的梯子，希望大家能找到稳定的梯子。）</p>
<h1 id="1准备">1.准备</h1>
<p>a) <strong>Win 10 64bit 1909</strong></p>
<p>b) <strong>Visual Studio 2019 Community 16.7.30503.244</strong></p>
<p>c) <strong>Windows 10 SDK</strong><br>
Windows 10.0.19041.1<br>
<img src="https://elegancewang.github.io/CPlusPlusNote.github.io/post-images/1600217267438.png" alt="" loading="lazy"></p>
<p>d) <strong>Python</strong></p>
<p>Python 3.8.5 64bit，编译过程中需添加到Path环境变量</p>
<p>f) <strong>depot_tools</strong><br>
depot_tools是包含下载、编译的相关工具，需要先下载并配置它，才能继续后面的操作。<br>
下载地址:<a href="https://storage.googleapis.com/chrome-infra/depot_tools.zip">depot_tools</a></p>
<p>下载后解压，并将解压好的depot_tools目录添加到path系统环境变量中，如下图所示：</p>
<figure data-type="image" tabindex="1"><img src="https://elegancewang.github.io/CPlusPlusNote.github.io/post-images/1600218587975.png" alt="" loading="lazy"></figure>
<h1 id="2-环境变量配置">2 环境变量配置</h1>
<p>有大量的环境变量需要配置，如果在cmd中set需要保持该窗口。一般在系统环境变量编辑里比较简单方便。<br>
最开始我的设置如下：</p>
<pre><code>DEPOT_TOOLS_UPDATE=0                                 #不更新depot_tools
DEPOT_TOOLS_WIN_TOOLCHAIN=0                          #编译时使用本机VS工具链
GYP_MSVS_VERSION = 2019                              #指定VS版本
GYP_MSVS_OVERRIDE_PATH = C:\Program Files (x86)\Microsoft Visual Studio\2019\Community  #vs安装路径，替换成自己的
GYP_GENERATORS=msvs-ninja,ninja                      #使用ninja编译

</code></pre>
<p><strong>Error</strong><br>
depot_tools/python3_bin_reldir.txt: No such file or directory<br>
failed to determine Python version</p>
<p>我认为是环境变量阻止了其在Windows下的引导，因此删去<code>DEPOT_TOOLS_UPDATE=0</code> 的环境变量即可.</p>
<h1 id="3获取webrtc源码">3.获取WebRTC源码</h1>
<p>接着执行<code>gclient</code>命令，安装编译需要用到的一些工具，比如git以及python。</p>
<p>其他的环境变量我们已经在前文设置，无需通过cmd进行设置，这是为了我自己的方便，如果对于环境变量有要求，请在cmd自行设置，例：</p>
<pre><code>set vs2019_install=C:\Program Files (x86)\Microsoft Visual Studio\2019\Community
set GYP_MSVS_OVERRIDE_PATH=C:\Program Files (x86)\Microsoft Visual Studio\2019\Community 
set GYP_GENERATORS=msvs-ninja,ninja
# 告诉depot_tools使用我们本机的VS进行编译
set DEPOT_TOOLS_WIN_TOOLCHAIN=0

</code></pre>
<p>然后cd到要放源码的地方（要遵守前面说的磁盘要求），执行：</p>
<pre><code>mkdir webrtc-checkout
cd webrtc-checkout
fetch --nohooks webrtc
gclient sync

</code></pre>
<p>这一过程的时间比较长，包括源码以及一些测试的音视频文件资源等。如果没有稳定快速的梯子需要等待较长时间。</p>
<p>如果因为网络等原因中断了，就再执行<code>gclient sync</code>。如果这一步一直卡着不动，可以执行<code>ctrl+c</code>，然后执行<code>gclient sync</code>。</p>
<h1 id="4编译">4.编译</h1>
<p>生成VS2019工程文件：</p>
<pre><code>cd src
gn gen --ide=vs out/Default

</code></pre>
<p>可以在src\out\Default\ 下得到 all.sln解决方案文件。</p>
<p>如果不想使用默认编译参数，可以使用gn args out/Default --list查看当前编译参数，通过类似如下方式设置：<br>
<code>gn gen --ide=vs out/Default --args=“use_rtti=true is_clang=false rtc_build_tools=false rtc_include_tests=false rtc_build_examples=false”</code></p>
<p>接着执行编译命令：</p>
<pre><code>ninja -C out/Default
</code></pre>
<h1 id="代码更新">代码更新</h1>
<pre><code>git checkout master
git pull origin master
gclient sync

</code></pre>
<h1 id="引用webrtc库">引用WebRTC库</h1>
<p>WebRTC编译后会在src\out\Default\obj目录下生成整个WebRTC工程的静态库：webrtc.lib，链接下这个就可以了。</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D">写在前面的话</a></li>
<li><a href="#1%E5%87%86%E5%A4%87">1.准备</a></li>
<li><a href="#2-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE">2 环境变量配置</a></li>
<li><a href="#3%E8%8E%B7%E5%8F%96webrtc%E6%BA%90%E7%A0%81">3.获取WebRTC源码</a></li>
<li><a href="#4%E7%BC%96%E8%AF%91">4.编译</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%9B%B4%E6%96%B0">代码更新</a></li>
<li><a href="#%E5%BC%95%E7%94%A8webrtc%E5%BA%93">引用WebRTC库</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/learnC/">
              <h3 class="post-title">
                C++学习笔记
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://elegancewang.github.io/CPlusPlusNote.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
