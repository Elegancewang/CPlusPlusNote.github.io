<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    Renzo&#39;s Blog
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="Renzo">
<meta name="description" content="å‰è·¯æ¼«æ¼«">
<meta name="keywords" content="KTBFFH, Dota2">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://elegancewang.github.io/CPlusPlusNote.github.io/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
    
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@1.0.12/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@1.0.12/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--ç‚¹å‡»ç‰¹æ•ˆ-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                    <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic@latest/assets/media/script/APlayer.min.js"></script>
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
                    
                        <!--CDNæ ·å¼-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://elegancewang.github.io/CPlusPlusNote.github.io">
                    Renzo&#39;s Blog
                </a>
            </div>

            <div class="menu navbar-right">
                
                    <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io">
                        é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/archives">
                        å½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/tags">
                        æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/about">
                        å…³äº
                    </a>
                    
                    <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/tu-jie-mi-ma-ji-zhu-ri-jie-cheng-hao-zong-jie">
                        Cryptography, Information Security and Privacy
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1604945447035" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://elegancewang.github.io/CPlusPlusNote.github.io">
                            Renzo&#39;s Blog
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1604945447035" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io">
                            é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/archives">
                            å½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/tags">
                            æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/about">
                            å…³äº
                        </a>
                        
                        <a class="menu-item" href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/tu-jie-mi-ma-ji-zhu-ri-jie-cheng-hao-zong-jie">
                            Cryptography, Information Security and Privacy
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                TC(Traffic Control)
                            </h1>
                            
                                    <!--zh-->
                                    <div class="post-meta zh">
                                        &#x4F5C;&#x8005;:
                                        <a itemprop="author" rel="author" href="/">
                                            Renzo's Blog
                                        </a>
                                        <span class="post-time">&#x65E5;&#x671F;: <a href="#">10-27-2020</a></span>
                                        <span class="post-readtime">&#x9605;&#x8BFB;&#x65F6;&#x95F4;:<a
                                    href="#">7.5
                                    &#x5206;&#x949F;</a></span>
                                        <span class="post-words">&#x5B57;&#x6570;:<a href="#">1868</a></span>
                                        
                                                é˜…è¯»é‡:
                                                <span data-hk-page="current"> - </span>
                                                
                                    </div>
                                    
                        </header>
                        
                        <div class="post-content">
                            <p>Linuxä¸­çš„æµé‡æ§åˆ¶</p>
<!-- more -->
<h1 id="1-tcåŸç†">1. TCåŸç†</h1>
<p>Linuxæ“ä½œç³»ç»Ÿä¸­çš„æµé‡æ§åˆ¶å™¨TCï¼ˆTraffic Controlï¼‰ç”¨äºLinuxå†…æ ¸çš„æµé‡æ§åˆ¶ï¼Œä¸»è¦æ˜¯é€šè¿‡åœ¨è¾“å‡ºç«¯å£å¤„å»ºç«‹ä¸€ä¸ªé˜Ÿåˆ—æ¥å®ç°æµé‡æ§åˆ¶ã€‚<br>
æ¥æ”¶åŒ…ä»è¾“å…¥æ¥å£è¿›æ¥åï¼Œç»è¿‡æµé‡é™åˆ¶ä¸¢å¼ƒä¸ç¬¦åˆè§„å®šçš„æ•°æ®åŒ…ï¼Œç”±è¾“å…¥å¤šè·¯åˆ†é…å™¨è¿›è¡Œåˆ¤æ–­é€‰æ‹©ï¼š</p>
<ul>
<li>å¦‚æœæ¥æ”¶åŒ…çš„ç›®çš„ä¸»æœºæ˜¯æœ¬ä¸»æœºï¼Œé‚£ä¹ˆå°†è¯¥åŒ…é€ç»™ä¸Šå±‚å¤„ç†ï¼Œå¦åˆ™éœ€è¦è¿›è¡Œè½¬å‘ï¼Œå°†æ¥æ”¶åŒ…äº¤åˆ°è½¬å‘å—ï¼ˆForwarding Blockï¼‰å¤„ç†ã€‚</li>
<li>è½¬å‘å—åŒæ—¶ä¹Ÿæ¥æ”¶æœ¬ä¸»æœºä¸Šå±‚(TCPã€UDPç­‰)äº§ç”Ÿçš„åŒ…ï¼Œé€šè¿‡æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œå†³å®šæ‰€å¤„ç†åŒ…çš„ä¸‹ä¸€è·³ã€‚</li>
<li>ç„¶åï¼Œå¯¹åŒ…è¿›è¡Œæ’åˆ—ä»¥ä¾¿å°†å®ƒä»¬é€åˆ°è¾“å‡ºæ¥å£ã€‚</li>
</ul>
<p>ä¸€èˆ¬åªèƒ½é™åˆ¶ç½‘å¡å‘é€çš„æ•°æ®åŒ…ï¼Œä¸èƒ½é™åˆ¶ç½‘å¡æ¥æ”¶çš„æ•°æ®åŒ…ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ”¹å˜å‘é€æ¬¡åºæ¥æ§åˆ¶ä¼ è¾“é€Ÿç‡ã€‚Linuxæµé‡æ§åˆ¶ä¸»è¦æ˜¯åœ¨è¾“å‡ºæ¥å£æ’åˆ—æ—¶è¿›è¡Œå¤„ç†å’Œå®ç°çš„ã€‚</p>
<h1 id="2-è§„åˆ™">2. è§„åˆ™</h1>
<h2 id="21-é˜Ÿåˆ—queues-å’Œæ’é˜Ÿè§„åˆ™queueing-disciplines">2.1 é˜Ÿåˆ—ï¼ˆQueuesï¼‰ å’Œæ’é˜Ÿè§„åˆ™ï¼ˆQueueing Disciplinesï¼‰</h2>
<p>é€šè¿‡å¯¹åŒ…è¿›è¡Œ<strong>æ’é˜Ÿ</strong>ï¼ˆqueuingï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ•°æ®çš„<strong>å‘é€æ–¹å¼</strong>ï¼ˆthe way in which data is SENTï¼‰ã€‚ä½†ç†è§£ä¸‹é¢è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼šæˆ‘ä»¬<strong>åªèƒ½å¯¹å‘é€</strong>ï¼ˆtransmitï¼‰<strong>çš„æ•°æ®è¿›è¡Œæ•´å½¢</strong>ï¼ˆshape the dataï¼‰ã€‚</p>
<p><strong>äº’è”ç½‘çš„å·¥ä½œæœºåˆ¶</strong>å†³å®šäº†<strong>æ¥æ”¶ç«¯æ— æ³•ç›´æ¥æ§åˆ¶å‘é€ç«¯çš„è¡Œä¸º</strong>ã€‚è¿™å°±åƒä½ å®¶çš„ ï¼ˆå®ä½“ï¼ï¼‰é‚®ç®±ä¸€æ ·ï¼šé™¤éèƒ½è”ç³»åˆ°æ‰€æœ‰äººï¼ˆå‘Šè¯‰ä»–ä»¬æœªç»åŒæ„ä¸è¦å¯„ä¿¡ç»™ä½ ï¼‰ï¼Œå¦åˆ™ ä½ æ— æ³•æ§åˆ¶åˆ«äººå¯„å¤šå°‘ä¸œè¥¿è¿‡æ¥ã€‚ğŸ˜‰</p>
<p>ä½†ä¸å®é™…ç”Ÿæ´»ä¸åŒçš„æ˜¯ï¼Œäº’è”ç½‘åŸºäº TCP/IP åè®®æ ˆï¼Œè¿™å¤šå°‘ä¼šå¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚TCP/IP æ— æ³•æå‰çŸ¥é“ä¸¤å°ä¸»æœºä¹‹é—´çš„ç½‘ç»œå¸¦å®½ï¼Œå› æ­¤å¼€å§‹æ—¶å®ƒä¼šä»¥è¶Šæ¥è¶Šå¿«çš„é€Ÿåº¦å‘é€æ•°æ®ï¼ˆæ…¢å¯ åŠ¨ï¼‰ï¼Œç›´åˆ°å¼€å§‹å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ—¶å®ƒçŸ¥é“å·²ç»æ²¡æœ‰å¯ç”¨ç©ºé—´æ¥å­˜å‚¨è¿™äº›å¾…å‘é€çš„åŒ…äº†ï¼Œå› æ­¤å°±ä¼š é™ä½å‘é€é€Ÿåº¦ã€‚TCP/IP çš„å®é™…å·¥ä½œè¿‡ç¨‹æ¯”è¿™ä¸ªæ›´æ™ºèƒ½ä¸€ç‚¹ï¼Œæˆ‘ä»¬åé¢ä¼šå†è®¨è®ºã€‚</p>
<p>è¿™å°±å¥½æ¯”ä½ ç•™ä¸‹ä¸€åŠçš„ä¿¡ä»¶åœ¨å®ä½“é‚®ç®±é‡Œä¸å–ï¼ŒæœŸæœ›åˆ«äººçŸ¥é“è¿™ä¸ªçŠ¶å†µåä¼šåœæ­¢ç»™ä½ å¯„æ–°çš„ä¿¡ä»¶ã€‚ ä½†ä¸å¹¸çš„æ˜¯ï¼Œ<strong>è¿™ç§æ–¹å¼åªå¯¹äº’è”ç½‘ç®¡ç”¨ï¼Œå¯¹ä½ çš„å®ä½“é‚®ç®±æ— æ•ˆ</strong> ğŸ˜ƒ</p>
<p>å¦‚æœå†…ç½‘æœ‰ä¸€å°è·¯ç”±å™¨ï¼Œä½ å¸Œæœ›é™åˆ¶æŸå‡ å°ä¸»æœºçš„ä¸‹è½½é€Ÿåº¦ï¼Œé‚£ä½ åº”è¯¥æ‰¾åˆ°å‘é€æ•°æ®åˆ° è¿™äº›ä¸»æœºçš„è·¯ç”±å™¨å†…éƒ¨æ¥å£ï¼ˆinner interface of your routerï¼‰ï¼Œç„¶ååœ¨è¿™äº› <strong>è·¯ç”±å™¨å†…éƒ¨æ¥å£</strong>ä¸Šåš <strong>æ•´æµ</strong>ï¼ˆtraffic shapingï¼Œæµé‡æ•´å½¢ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜è¦ç¡®ä¿<strong>é“¾è·¯ç“¶é¢ˆ</strong>ï¼ˆbottleneck of the linkï¼‰ä¹Ÿåœ¨ä½ çš„æ§åˆ¶èŒƒå›´å†…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç½‘ å¡æ˜¯ 100Mbpsï¼Œä½†è·¯ç”±å™¨çš„é“¾è·¯å¸¦å®½æ˜¯ 256Kbpsï¼Œé‚£é¦–å…ˆåº”è¯¥<strong>ç¡®ä¿ä¸è¦å‘é€è¿‡å¤šæ•°æ®ç»™è·¯ç”±å™¨</strong>ï¼Œå› ä¸ºå®ƒå¯èƒ½æ‰›ä¸ä½ã€‚<strong>å¦åˆ™ï¼Œé“¾è·¯æ§åˆ¶å’Œå¸¦å®½æ•´å½¢çš„å†³å®šæƒå°±ä¸åœ¨ä¸»æœºä¾§è€Œåˆ°è·¯ç”±å™¨ä¾§äº†</strong>ã€‚è¦è¾¾åˆ°é™é€Ÿç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹â€œ<strong>å‘é€é˜Ÿåˆ—</strong>â€æœ‰å®Œå…¨çš„æŠŠæ§ï¼ˆâ€own the queueâ€ï¼‰ï¼Œè¿™é‡Œçš„â€œå‘é€é˜Ÿåˆ—â€ä¹Ÿå°±æ˜¯<strong>æ•´æ¡é“¾è·¯ä¸Šæœ€æ…¢çš„ä¸€æ®µ</strong>ï¼ˆslowest link in the chainï¼‰ã€‚ å¹¸è¿çš„æ˜¯ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹è¿™ä¸ªæ¡ä»¶éƒ½æ˜¯èƒ½æ»¡è¶³çš„ã€‚</p>
<h2 id="22-simple-classless-qdiscç®€å•-ä¸åˆ†ç±»æ’é˜Ÿè§„åˆ™">2.2 Simpleï¼Œ classless qdiscï¼ˆç®€å•ã€ä¸åˆ†ç±»æ’é˜Ÿè§„åˆ™ï¼‰</h2>
<p>å¦‚å‰æ‰€è¿°ï¼Œ<strong>æ’é˜Ÿè§„åˆ™</strong>ï¼ˆqueueing disciplinesï¼‰æ”¹å˜äº†æ•°æ®çš„å‘é€æ–¹å¼ã€‚</p>
<p><strong>ä¸åˆ†ç±»ï¼ˆæˆ–ç§°æ— ç±»åˆ«ï¼‰æ’é˜Ÿè§„åˆ™</strong>ï¼ˆclassless queueing disciplinesï¼‰å¯ä»¥å¯¹æŸä¸ªç½‘ç»œ æ¥å£ï¼ˆinterfaceï¼‰ä¸Šçš„æ‰€æœ‰æµé‡è¿›è¡Œ<strong>æ— å·®åˆ«æ•´å½¢</strong>ã€‚åŒ…æ‹¬å¯¹æ•°æ®è¿›è¡Œï¼š</p>
<ul>
<li>é‡æ–°è°ƒåº¦ï¼ˆrescheduleï¼‰</li>
<li>å¢åŠ å»¶è¿Ÿï¼ˆdelayï¼‰</li>
<li>ä¸¢å¼ƒï¼ˆdropï¼‰</li>
</ul>
<p>ä¸ classless qdisc å¯¹åº”çš„æ˜¯ classful qdiscï¼Œå³<strong>æœ‰ç±»åˆ«ï¼ˆæˆ–ç§°åˆ†ç±»åˆ«ï¼‰æ’é˜Ÿè§„åˆ™</strong>ï¼Œåè€…æ˜¯ä¸€ä¸ª<strong>æ’é˜Ÿè§„åˆ™ä¸­åˆåŒ…å«å…¶ä»–æ’é˜Ÿè§„åˆ™</strong>ï¼ˆqdisc-containing-qdiscsï¼‰ï¼ğŸ˜® å…ˆç†è§£äº† classless qdiscï¼Œæ‰èƒ½ç†è§£ classful qdiscã€‚<br>
ç›®å‰æœ€å¸¸ç”¨çš„ classless qdisc æ˜¯ <code>pfifo_fast qdisc</code>ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤æ’é˜Ÿè§„åˆ™ã€‚ è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¿™äº›é«˜çº§åŠŸèƒ½å¦‚æ­¤å¥å£®ï¼šæœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒä»¬åªä¸è¿‡æ˜¯â€œå¦ä¸€ä¸ªé˜Ÿåˆ—â€è€Œ å·²ï¼ˆnothing more than â€˜just another queueâ€™ï¼‰ã€‚<br>
æ¯ç§é˜Ÿåˆ—éƒ½æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ã€‚å…¶ä¸­ä¸€äº›å¯èƒ½æµ‹è¯•çš„å¹¶ä¸å…¨é¢ã€‚</p>
<h2 id="22-pfifo_fastå…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—">2.2 pfifo_fastï¼ˆå…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ï¼‰</h2>
<p>å¦‚åå­—æ‰€ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªå…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFirst In, First Outï¼‰ï¼Œå› æ­¤å¯¹æ‰€æœ‰åŒ…éƒ½ä¸€è§†åŒä»ã€‚</p>
<p>pfifo_fast æœ‰<strong>ä¸‰ä¸ªæ‰€è°“çš„ â€œbandâ€</strong>ï¼ˆå¯ç†è§£ä¸ºä¸‰ä¸ªé˜Ÿåˆ—ï¼‰ï¼Œç¼–å·åˆ†åˆ«ä¸º 0ã€1ã€2ï¼š</p>
<ul>
<li><strong>æ¯ä¸ª band ä¸Šåˆ†åˆ«æ‰§è¡Œ FIFO è§„åˆ™</strong>ã€‚</li>
<li><strong>å¦‚æœ band 0 æœ‰æ•°æ®ï¼Œå°±ä¸ä¼šå¤„ç† band 1</strong>ï¼›åŒç†ï¼Œband 1 æœ‰æ•°æ®æ—¶ï¼Œ ä¸ä¼šå»å¤„ç† band 2ã€‚</li>
<li>å†…æ ¸ä¼šæ£€æŸ¥<strong>æ•°æ®åŒ…çš„ TOS å­—æ®µ</strong>ï¼Œå°†**â€œæœ€å°å»¶è¿Ÿâ€çš„åŒ…æ”¾åˆ° band 0**ã€‚</li>
</ul>
<p>ä¸è¦å°† <code>pfifo_fast qdisc</code> ä¸åé¢ä»‹ç»çš„ <code>PRIO qdisc</code> æ··æ·†ï¼Œåè€…æ˜¯ classful çš„ï¼ è™½ç„¶äºŒè€…è¡Œä¸ºç±»ä¼¼ï¼Œä½† <strong><code>pfifo_fast</code> æ˜¯æ— ç±»åˆ«</strong>çš„ï¼Œè¿™æ„å‘³ä½ <strong>æ— æ³•é€šè¿‡ <code>tc</code> å‘½ä»¤å‘ <code>pfifo_fast</code> å†…æ·»åŠ å¦ä¸€ä¸ª qdiscã€‚</strong></p>
<h3 id="221-å‚æ•°ä¸ç”¨æ³•">2.2.1 å‚æ•°ä¸ç”¨æ³•</h3>
<p><code>pfifo_fast qdisc</code> é»˜è®¤é…ç½®æ˜¯å†™æ­»çš„ï¼ˆthe hardwired defaultï¼‰ï¼Œå› æ­¤<strong>æ— æ³•æ›´æ”¹</strong>ã€‚</p>
<p>ä¸‹é¢ä»‹ç»è¿™ä»½å†™æ­»çš„é…ç½®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<ul>
<li><strong><code>priomap</code></strong><br>
<code>priomap</code> å†³å®šäº†<strong>å¦‚ä½•å°†å†…æ ¸è®¾ç½®çš„ packet priority æ˜ å°„åˆ° band</strong>ã€‚priority ä½äºåŒ…çš„ TOS å­—æ®µï¼š</li>
</ul>
<pre><code>     0     1     2     3     4     5     6     7
  +-----+-----+-----+-----+-----+-----+-----+-----+
  |                 |                       |     |
  |   PRECEDENCE    |          TOS          | MBZ |
  |                 |                       |     |
  +-----+-----+-----+-----+-----+-----+-----+-----+s
</code></pre>
<p>TOS å­—æ®µå ç”¨ 4 ä¸ªæ¯”ç‰¹ï¼Œå„ bit å«ä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code>  Binary Decimcal  Meaning
  -----------------------------------------
  1000   8         Minimize delay (md)
  0100   4         Maximize throughput (mt)
  0010   2         Maximize reliability (mr)
  0001   1         Minimize monetary cost (mmc)
  0000   0         Normal Service
</code></pre>
<p><code>tcpdump -vv</code> ä¼šæ‰“å°åŒ…çš„ TOS å­—æ®µï¼Œå…¶ä¸­çš„ TOS å€¼å¯¹åº”ä¸‹é¢çš„ç¬¬ä¸€åˆ—ï¼š</p>
<pre><code class="language-sql">  TOS     Bits  Means                    Linux Priority    Band
  ------------------------------------------------------------
  0x0     0     Normal Service           0 Best Effort     1
  0x2     1     Minimize Monetary Cost   1 Filler          2
  0x4     2     Maximize Reliability     0 Best Effort     1
  0x6     3     mmc+mr                   0 Best Effort     1
  0x8     4     Maximize Throughput      2 Bulk            2
  0xa     5     mmc+mt                   2 Bulk            2
  0xc     6     mr+mt                    2 Bulk            2
  0xe     7     mmc+mr+mt                2 Bulk            2
  0x10    8     Minimize Delay           6 Interactive     0
  0x12    9     mmc+md                   6 Interactive     0
  0x14    10    mr+md                    6 Interactive     0
  0x16    11    mmc+mr+md                6 Interactive     0
  0x18    12    mt+md                    4 Int. Bulk       1
  0x1a    13    mmc+mt+md                4 Int. Bulk       1
  0x1c    14    mr+mt+md                 4 Int. Bulk       1
  0x1e    15    mmc+mr+mt+md             4 Int. Bulk       1
</code></pre>
<p>ç¬¬äºŒåˆ—æ˜¯å¯¹åº”çš„åè¿›åˆ¶è¡¨ç¤ºï¼Œç¬¬ä¸‰åˆ—æ˜¯å¯¹åº”çš„å«ä¹‰ã€‚ä¾‹å¦‚ï¼Œ<code>15</code> è¡¨ç¤ºè¿™ä¸ªåŒ…æœŸæœ› <code>Minimal Monetary Cost</code> + <code>Maximum Reliability</code> + <code>Maximum Throughput</code> + <code>Minimum Delay</code>ã€‚æˆ‘æŠŠè¿™æ ·çš„åŒ…ç§°ä¸ºâ€œè·å…°åŒ…â€ï¼ˆa â€˜Dutch Packetâ€™ã€‚è·å…°äººæ¯”è¾ƒ èŠ‚ä¿­/æŠ é—¨ï¼Œè¯‘æ³¨ï¼‰ã€‚<strong>ç¬¬å››åˆ—æ˜¯å¯¹åº”åˆ° Linux å†…æ ¸çš„ä¼˜å…ˆçº§ï¼›æœ€åä¸€åˆ—æ˜¯ æ˜ å°„åˆ°çš„ band</strong>ï¼Œä»å‘½ä»¤è¡Œè¾“å‡ºçœ‹ï¼Œå½¢å¼ä¸ºï¼š</p>
<pre><code>  1, 2, 2, 2, 1, 2, 0, 0 , 1, 1, 1, 1, 1, 1, 1, 1
</code></pre>
<p>ä¾‹å¦‚ï¼Œpriority 4 ä¼šæ˜ å°„åˆ° band 1ã€‚priomap è¿˜èƒ½åˆ—å‡º priority &gt; 7 çš„é‚£äº› ä¸æ˜¯ç”± TOS æ˜ å°„ã€è€Œæ˜¯ç”±å…¶ä»–æ–¹å¼è®¾ç½®çš„ä¼˜å…ˆçº§ã€‚ä¾‹å¦‚ï¼Œä¸‹è¡¨åˆ—å‡ºäº†<strong>åº”ç”¨ï¼ˆapplicationï¼‰æ˜¯å¦‚ä½•è®¾ç½®å®ƒä»¬çš„ TOS å­—æ®µ</strong>çš„ï¼Œæ¥è‡ª RFC 1349ï¼ˆæ›´å¤šä¿¡æ¯å¯<a href="https://tools.ietf.org/html/rfc1349">é˜…è¯»å…¨æ–‡</a>)</p>
<pre><code>  TELNET                   1000           (minimize delay)
  FTP     Control          1000           (minimize delay)
          Data             0100           (maximize throughput)
    
  TFTP                     1000           (minimize delay)
    
  SMTP    Command phase    1000           (minimize delay)
          DATA phase       0100           (maximize throughput)
    
  DNS     UDP Query        1000           (minimize delay)
          TCP Query        0000
          Zone Transfer    0100           (maximize throughput)
    
  NNTP                     0001           (minimize monetary cost)
    
  ICMP    Errors           0000
          Requests         0000 (mostly)
          Responses        &lt;same as request&gt; (mostly)
</code></pre>
<ul>
<li><code>txqueuelen</code><br>
å‘é€é˜Ÿåˆ—é•¿åº¦ï¼Œæ˜¯ä¸€ä¸ªç½‘ç»œæ¥å£ï¼ˆinterfaceï¼‰å‚æ•°ï¼Œå¯ä»¥ç”¨ <code>ifconfig</code> å‘½ä»¤è®¾ç½®ã€‚ä¾‹ å¦‚ï¼Œ<code>ifconfig eth0 txqueuelen 10</code>ã€‚<br>
<code>tc</code> å‘½ä»¤æ— æ³•ä¿®æ”¹è¿™ä¸ªå€¼ã€‚
<h2 id="23-tbftoken-bucket-filterä»¤ç‰Œæ¡¶è¿‡æ»¤å™¨">2.3 TBFï¼ˆToken Bucket Filterï¼Œä»¤ç‰Œæ¡¶è¿‡æ»¤å™¨ï¼‰</h2>
</li>
</ul>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li><a href="#1-tc%E5%8E%9F%E7%90%86">1. TCåŸç†</a></li>
<li><a href="#2-%E8%A7%84%E5%88%99">2. è§„åˆ™</a>
<ul>
<li><a href="#21-%E9%98%9F%E5%88%97queues-%E5%92%8C%E6%8E%92%E9%98%9F%E8%A7%84%E5%88%99queueing-disciplines">2.1 é˜Ÿåˆ—ï¼ˆQueuesï¼‰ å’Œæ’é˜Ÿè§„åˆ™ï¼ˆQueueing Disciplinesï¼‰</a></li>
<li><a href="#22-simple-classless-qdisc%E7%AE%80%E5%8D%95-%E4%B8%8D%E5%88%86%E7%B1%BB%E6%8E%92%E9%98%9F%E8%A7%84%E5%88%99">2.2 Simpleï¼Œ classless qdiscï¼ˆç®€å•ã€ä¸åˆ†ç±»æ’é˜Ÿè§„åˆ™ï¼‰</a></li>
<li><a href="#22-pfifo_fast%E5%85%88%E5%85%A5%E5%85%88%E5%87%BA%E9%98%9F%E5%88%97">2.2 pfifo_fastï¼ˆå…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ï¼‰</a>
<ul>
<li><a href="#221-%E5%8F%82%E6%95%B0%E4%B8%8E%E7%94%A8%E6%B3%95">2.2.1 å‚æ•°ä¸ç”¨æ³•</a></li>
</ul>
</li>
<li><a href="#23-tbftoken-bucket-filter%E4%BB%A4%E7%89%8C%E6%A1%B6%E8%BF%87%E6%BB%A4%E5%99%A8">2.3 TBFï¼ˆToken Bucket Filterï¼Œä»¤ç‰Œæ¡¶è¿‡æ»¤å™¨ï¼‰</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                            <!--zh-->
                                            <section class="post-copyright zh">
                                                <p class="copyright-item ">
                                                    <span>&#x4F5C;&#x8005;:</span>
                                                    <span>Renzo's Blog</span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x6C38;&#x4E45;&#x94FE;&#x63A5;:</span>
                                                    <span><a href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/tctraffic-control/">https://elegancewang.github.io/CPlusPlusNote.github.io/post/tctraffic-control/</a></span>
                                                </p>

                                                <p class="copyright-item">
                                                    <span>&#x534F;&#x8BAE;:</span>
                                                    <span>MIT License</span>
                                                </p>
                                            </section>
                                            
                                                
                                                    
                                                                    <!--Share-->
                                                                    <span style="margin-right:15px">
                        <i class="post-share"></i>
                        <span>&#x5206;&#x4EAB;:</span>
                                                                    <a title="QR ç " target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://elegancewang.github.io/CPlusPlusNote.github.io/post/tctraffic-control/"><i class="fa fa-qrcode"></i></a>
                                                                    <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://elegancewang.github.io/CPlusPlusNote.github.io/post/tctraffic-control/&sharesource=qzone&title=TC(Traffic Control)&pics=https://elegancewang.github.io/CPlusPlusNote.github.io/images/avatar.png?v=1604945447035&summary=&lt;p&gt;Linuxä¸­çš„æµé‡æ§åˆ¶&lt;/p&gt;
"><i class="fa fa-qq"></i></a>
                                                                    <a title="æ–°æµªå¾®åš" target="_blank" href="https://service.weibo.com/share/share.php?url=https://elegancewang.github.io/CPlusPlusNote.github.io/post/tctraffic-control/&sharesource=weibo&title=TC(Traffic Control) + " - " + &lt;p&gt;Linuxä¸­çš„æµé‡æ§åˆ¶&lt;/p&gt;
&pic="https://elegancewang.github.io/CPlusPlusNote.github.io/images/avatar.png?v=1604945447035 "><i class="fa fa-weibo "></i></a>

                                                                    </span>
                                                                    
                                                                        <div class="reward ">
                                                                            <div class="reward-button ">&yen;
                                                                                <span class="reward-code "> 
                        <span class="alipay-code "> <img class="alipay-img " alt = "support " src="https://blog.itjoker.cn/alipay.jpg"><b>æ”¯ä»˜å®</b> </span>
                                                                                <span class="wechat-code "> <img alt ="support " class="wechat-img " src="https://blog.itjoker.cn/wechat.jpg"><b>å¾®ä¿¡</b> </span> </span>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                            <!--zh-->
                                                                            <section class="post-tags zh ">
                                                                                <div>
                                                                                    <span>&#x6807;&#x7B7E;:</span>
                                                                                    <span class="tag ">
                        
                                </span>
                                                                                </div>
                                                                                <div>
                                                                                    <a href="javascript:window.history.back();">
                        &#x8FD4;&#x56DE;</a>
                                                                                    <span>&dot;</span>
                                                                                    <a href="#">&#x4E3B;&#x9875;</a>
                                                                                </div>
                                                                            </section>

                                                                            
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/linux-tian-jia-wang-qia/">
                                                                                            Linuxæ·»åŠ ç½‘å¡
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="https://elegancewang.github.io/CPlusPlusNote.github.io/post/webrtc-huan-jing-pei-zhi/">
                                                                                                    WebRTC ç¯å¢ƒé…ç½®ï¼ˆWindows å¹³å°ï¼‰
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
            </div>
    </div>
    </div>
    </div>
    
    <div id="player"></div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        Renzo&#39;s Blog &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://coding.net" target="_blank">
                                                Github
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.5
                </div>
                
                    <script>
                        var pat = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + pat + '</div>')
                    </script>
        </footer>
        
                <script>
                    

                    function LoadPlayer() {
                        var music_array = [];
                        
                        music_array.push({
                            name: '',
                            url: '',
                            artist: '',
                            cover: '',
                        });
                        
                        console.log(" MusicList: " + music_array);
                        
                        const ap = new APlayer({
                            container: document.getElementById('player'),
                            fixed: true,
                            audio: music_array
                        });
                        
                    }
                    LoadPlayer();
                    
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1604945447035);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
                
                    <div id="tp-weather-widget" style="background: #666;display: flex;"></div>
                    <script>
                        (function(T, h, i, n, k, P, a, g, e) {
                            g = function() {
                                P = h.createElement(i);
                                a = h.getElementsByTagName(i)[0];
                                P.src = k;
                                P.charset = "utf-8";
                                P.async = 1;
                                a.parentNode.insertBefore(P, a)
                            };
                            T["ThinkPageWeatherWidgetObject"] = n;
                            T[n] || (T[n] = function() {
                                (T[n].q = T[n].q || []).push(arguments)
                            });
                            T[n].l = +new Date();
                            if (T.attachEvent) {
                                T.attachEvent("onload", g)
                            } else {
                                T.addEventListener("load", g, false)
                            }
                        }(window, document, "script", "tpwidget", "//widget.seniverse.com/widget/chameleon.js"))
                    </script>
                    <script>
                        var wearther_margin = "10px 10px";
                        
                        wearther_margin = "70px 5px";
                        
                        tpwidget("init", {
                            "flavor": "bubble",
                            "location": "WX4FBXXFKE4F",
                            "geolocation": "enabled",
                            "position": "bottom-left",
                            "margin": wearther_margin,
                            "language": "zh-chs",
                            "unit": "c",
                            "theme": "chameleon",
                            "uid": "UFC977E1C7",
                            "hash": "213ad798bc472dc365da3a9d4a9ff115"
                        });
                        tpwidget("show");
                    </script>
                    
        </div>
</body>
<script>
    scroll();
</script>

</html>